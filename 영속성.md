## **ì˜ì†ì„± ê´€ë ¨ ë©”ì†Œë“œ ë¹„êµí‘œ**

| **ë©”ì†Œë“œ** | **ì£¼ìš” ê¸°ëŠ¥** | **ìƒíƒœ ë³€í™”** | **DB ì˜í–¥** | **ë³€ê²½ ê°ì§€** |
| --- | --- | --- | --- | --- |
| persist | ì—”í‹°í‹° ë“±ë¡ | ë¹„ì˜ì† â†’ ì˜ì† | ì»¤ë°‹ ì‹œ INSERT | O |
| detach | ì—”í‹°í‹° ë¶„ë¦¬ | ì˜ì† â†’ ì¤€ì˜ì† | ì—†ìŒ | X |
| merge | ì—”í‹°í‹° ë³‘í•© | ì¤€ì˜ì†/ë¹„ì˜ì† â†’ ì˜ì† | í•„ìš” ì‹œ UPDATE | O |
| remove | ì—”í‹°í‹° ì‚­ì œ | ì˜ì† â†’ ì‚­ì œ | ì»¤ë°‹ ì‹œ DELETE | O |
| refresh | ì—”í‹°í‹° ìƒˆë¡œê³ ì¹¨ | ë³€í™” ì—†ìŒ | SELECT | O |
1. ì˜ì† (Managed)
    - JPAê°€ ì—”í‹°í‹°ë¥¼ ê´€ë¦¬í•˜ëŠ” ìƒíƒœ
    - íŠ¹ì§•:
        - ë³€ê²½ ê°ì§€ (Dirty Checking) ëŒ€ìƒ
        - 1ì°¨ ìºì‹œì— ì €ì¥ë¨
        - íŠ¸ëœì­ì…˜ ì»¤ë°‹ ì‹œ ìë™ìœ¼ë¡œ DBì— ë°˜ì˜
    - ì˜ˆ: entityManager.persist(entity) í˜¸ì¶œ í›„
2. ì¤€ì˜ì† (Detached)
    - í•œë•Œ ì˜ì† ìƒíƒœì˜€ì§€ë§Œ í˜„ì¬ëŠ” JPA ê´€ë¦¬ì—ì„œ ë²—ì–´ë‚œ ìƒíƒœ
    - íŠ¹ì§•:
        - ì‹ë³„ì(ID)ëŠ” ê°€ì§€ê³  ìˆìŒ
        - ë³€ê²½ ê°ì§€ ëŒ€ìƒì—ì„œ ì œì™¸
        - DB ë™ê¸°í™” ë˜ì§€ ì•ŠìŒ
    - ì˜ˆ: entityManager.detach(entity) í˜¸ì¶œ í›„
3. ë¹„ì˜ì† (Transient)
    - JPAì™€ ì „í˜€ ê´€ê³„ì—†ëŠ” ìƒˆë¡œìš´ ê°ì²´ ìƒíƒœ
    - íŠ¹ì§•:
        - ì‹ë³„ì ê°’ ì—†ì„ ìˆ˜ ìˆìŒ
        - JPAê°€ ê´€ë¦¬í•˜ì§€ ì•ŠìŒ
        - DBì™€ ì „í˜€ ê´€ê³„ ì—†ìŒ
    - ì˜ˆ: new Entity() ë¡œ ê°ì²´ ìƒì„± ì§í›„

---

1. ë¹„ì˜ì† (New/Transient):
    - ìƒˆë¡œ ìƒì„±ëœ ê°ì²´, JPAì™€ ê´€ë ¨ ì—†ìŒ
    - ì˜ˆ:Â **`new Member()`**
2. ì˜ì† (Managed):
    - JPAê°€ ê´€ë¦¬í•˜ëŠ” ìƒíƒœ
    - **`entityManager.persist(entity)`**Â ë˜ëŠ” ì¡°íšŒ í›„
3. ì¤€ì˜ì† (Detached):
    - ì˜ì† ìƒíƒœì˜€ë‹¤ê°€ ë¶„ë¦¬ëœ ìƒíƒœ
    - **`entityManager.detach(entity)`**Â ë˜ëŠ”Â **`clear()`**,Â **`close()`**Â í›„
4. ì‚­ì œ (Removed):
    - ì‚­ì œ ì˜ˆì • ìƒíƒœ
    - **`entityManager.remove(entity)`**Â í˜¸ì¶œ í›„

ì£¼ìš” ì „í™˜:

- ë¹„ì˜ì† â†’ ì˜ì†:Â **`persist()`**
- ì˜ì† â†’ ì¤€ì˜ì†:Â **`detach()`**,Â **`clear()`**,Â **`close()`**
- ì¤€ì˜ì† â†’ ì˜ì†:Â **`merge()`**
- ì˜ì† â†’ ì‚­ì œ:Â **`remove()`**

---

## Blog Entity êµ¬í˜„í•˜ê¸°

### 1. í´ë˜ìŠ¤ ì •ì˜ í•˜ê¸°

- @Entity ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ ì´ í´ë˜ìŠ¤ê°€ DB Tableê³¼ ë§¤í•‘ë  JPA Entityì„ì„ ì„ ì–¸
- @Table(name-â€blogsâ€)ë¡œ ì‹¤ì œ DB Tableì´ë¦„ã…‡ë¥´ ì§€ì •

```java
@Entity
@Table(name = "blogs")
public class Blog {
}
```

### 2. í•„ë“œ ì •ì˜ í•˜ê¸°

- ê¸°ë³¸ì ìœ¼ë¡œ ê° í•„ë“œëŠ” DB í…Œì´ë¸” ì»¬ëŸ¼ê³¼ ë§¤í•‘ ë¨
- @Idë¡œ ê¸°ë³¸í‚¤ ì§€ì •
- @GeneratedValue(strategy = ìƒì„±ì „ëµ) ì„ í†µí•´ ìƒì„±ì „ëµ ì§€ì • Generation.Type.IDENTITYëŠ” DBì˜ AUTO-INCREAMENTì™€ ê°™ìŒ
- @Column ì„ í†µí•´ ê° í•„ë“œ íŠ¹ì„± NOT NULL, length(varchar) ë“±ì„ ì§€ì •..

```java

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY) // ê¸°ë³¸í‚¤ ìƒì„± ì „ëµ (AUTO-INCREAMENT)
    @Column(nullable = false)
    private Long blogId;

    @Column(nullable = false, length = 50)
    private String blogFid;

    @Column(nullable = false, unique = true)
    private boolean blogMain;

    @Column(nullable = false, length = 100)
    private String blogName;

    @Column(nullable = false, length = 100)
    private String blogMbNickname;

    @Column
    private String blogDescription;

    @Column(nullable = false)
    private Boolean blogIsPublic;

    @CreationTimestamp  // ì—”í‹°í‹° ìƒì„±ì‹œ ìë™ìœ¼ë¡œ í˜„ì¬ ì‹œê°„ ì„¤ì •
    @Column(nullable = false)
    private LocalDateTime createdAt;

    @Column
    private LocalDateTime updatedAt;

```

### 3. ìƒì„±ì

- protected ê¸°ë³¸ ìƒì„±ì: JPAê°€ ì—”í‹°í‹°ë¥¼ ìƒì„±í•  ë•Œ ì‚¬ìš©
- private ì „ì²´ í•„ë“œ ìƒì„±ì: ì—”í‹°í‹° ìƒì„± ì‹œ ì‚¬ìš©

```java
 		protected Blog(){

    }

    private Blog(Long blogId, String blogFid, boolean blogMain, String blogName, String blogMbNickname, String blogDescription, Boolean blogIsPublic, LocalDateTime createdAt, LocalDateTime updatedAt) {
        this.blogId = blogId;
        this.blogFid = blogFid;
        this.blogMain = blogMain;
        this.blogName = blogName;
        this.blogMbNickname = blogMbNickname;
        this.blogDescription = blogDescription;
        this.blogIsPublic = blogIsPublic;
        this.createdAt = createdAt;
        this.updatedAt = updatedAt;
    }
```

### 4. ì •ì  íŒ©í† ë¦¬ ë©”ì†Œë“œ

```java
  public static Blog ofNewBlog(String blogFid, Boolean blogMain, String blogName, String blogMbNickname, String blogDescription){
        return new Blog(null, blogFid, blogMain, blogName, blogMbNickname, blogDescription, false, null, null);

    }
```

- ìƒˆë¡œìš´ ë¸”ë¡œê·¸ ê°ì²´ ìƒì„± ë©”ì†Œë“œ

### 5. ìƒëª… ì£¼ê¸° ì½œë°± ë©”ì†Œë“œ

```java
  @PrePersist  // ì—”í‹°í‹°ê°€ ì²˜ìŒ ì €ì¥ ë  ë•Œ ì‹¤í–‰
    public void prePersistForCreatedAtAndUpdatedAt(){
        this.createdAt=null;
        this.updatedAt=null;
        // nullê°’ì¼ì‹œ DBì—ì„œ ìë™ìœ¼ë¡œ í˜„ì¬ ì‹œê°„ ì„¤ì •
    }

    @PreUpdate // ì—”í‹°í‹° ì—…ë°ì´íŠ¸ì‹œ ì‹¤í–‰
    public void preUpdateForUpdatedAt(){
        this.updatedAt = LocalDateTime.now();
    }
```

### 6. update, Getter , equals, hashCode, toString ,,

```java
 public void update(String blogName, String blogMbNickname, String blogDescription, Boolean blogIsPublic){
        this.blogName = blogName;
        this.blogMbNickname = blogMbNickname;
        this.blogDescription = blogDescription;
        this.blogIsPublic = blogIsPublic;
    }
     @Override
    public boolean equals(Object o) {
        if (o == null || getClass() != o.getClass()) return false;
        Blog blog = (Blog) o;
        return blogMain == blog.blogMain && Objects.equals(blogId, blog.blogId) && Objects.equals(blogFid, blog.blogFid) && Objects.equals(blogName, blog.blogName) && Objects.equals(blogMbNickname, blog.blogMbNickname) && Objects.equals(blogDescription, blog.blogDescription) && Objects.equals(blogIsPublic, blog.blogIsPublic) && Objects.equals(createdAt, blog.createdAt) && Objects.equals(updatedAt, blog.updatedAt);
    }

    @Override
    public int hashCode() {
        return Objects.hash(blogId, blogFid, blogMain, blogName, blogMbNickname, blogDescription, blogIsPublic, createdAt, updatedAt);
    }

    @Override
    public String toString() {
        return "Blog{" +
                "blogId=" + blogId +
                ", blogFid='" + blogFid + '\'' +
                ", blogMain=" + blogMain +
                ", blogName='" + blogName + '\'' +
                ", blogMbNickname='" + blogMbNickname + '\'' +
                ", blogDescription='" + blogDescription + '\'' +
                ", blogIsPublic=" + blogIsPublic +
                ", createdAt=" + createdAt +
                ", updatedAt=" + updatedAt +
                '}';
    }
    /**
     * ë¸”ë¡œê·¸ ê³µê°œì—¬ë¶€ ì„¤ì •
     * @param blogIsPublic
     */
    public void enableBlogPublicAccess(boolean blogIsPublic){
        this.blogIsPublic = blogIsPublic;
    }
    
    
    // ì´ì™¸ Getter Method
```

## í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±í•˜ê¸°

```java
package com.nhnacademy.blog.bloginfo.domain;

import com.nhnacademy.blog.common.config.ApplicationConfig;

import jakarta.persistence.Entity;
import jakarta.persistence.EntityManager;
import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.ExtendWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.test.context.ActiveProfiles;
import org.springframework.test.context.ContextConfiguration;
import org.springframework.test.context.junit.jupiter.SpringExtension;
import org.springframework.transaction.annotation.Transactional;

/**
 * TODO#2-TEST blog entity Test êµ¬í˜„
 */

@ActiveProfiles("test")
@ExtendWith(SpringExtension.class)
@ContextConfiguration(classes = ApplicationConfig.class)
@Transactional
class BlogTest {

    @Autowired
    EntityManager entityManager;

    @Test
    @DisplayName("blog ë“±ë¡")
    void saveTest(){
        Blog blog = Blog.ofNewBlog(
                "testBlogFid",
                false,
                "testName",
                "testMbNickName",
                "testBlogDescription"
        );

        entityManager.persist(blog);
        entityManager.flush();

        Blog findBlog = entityManager.find(Blog.class, blog.getBlogId());

        Assertions.assertNotNull(blog);
        Assertions.assertEquals(blog, findBlog);
    }

    @Test
    @DisplayName("blog ìˆ˜ì •")
    void updateTest(){
        Blog blog = Blog.ofNewBlog(
                "testBlogFid",
                false,
                "testName",
                "testMbNickName",
                "testBlogDescription"
        );

        entityManager.persist(blog);

        entityManager.flush();

        blog.update("updateName", "updateMbNicName", "updateDescription", true);

        Blog findBlog = entityManager.find(Blog.class, blog.getBlogId());
        Assertions.assertNotNull(findBlog);
        Assertions.assertEquals(blog, findBlog);

    }

    @Test
    @DisplayName("blog ì‚­ì œ")
    void deleteTest(){
        Blog blog = Blog.ofNewBlog(
                "testBlogFid",
                false,
                "testName",
                "testMbNickName",
                "testBlogDescription"
        );

        entityManager.persist(blog);
        entityManager.flush();

        Long blogId = blog.getBlogId();

        entityManager.remove(blog);
        entityManager.flush();

        entityManager.clear();

        Blog deleteBlog = entityManager.find(Blog.class, blog.getBlogId());
        Assertions.assertNull(deleteBlog, "ì‚­ì œëœ blogëŠ” nullì´ì–´ì•¼í•¨");

    }

}
```

---

ë ˆì „ë“œ ë ˆì½”ë“œ

```java
public class BlogMemberResponse {
    private final Long blogId;
    private final String blogName;
    private final Long mbNo;
    private final String mbName;

    public BlogMemberResponse(Long blogId, String blogName, Long mbNo, String mbName) {
        this.blogId = blogId;
        this.blogName = blogName;
        this.mbNo = mbNo;
        this.mbName = mbName;
    }

    public Long getBlogId() {
        return blogId;
    }

    public String getBlogName() {
        return blogName;
    }

    public Long getMbNo() {
        return mbNo;
    }

    public String getMbName() {
        return mbName;
    }

    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (o == null || getClass() != o.getClass()) return false;
        BlogMemberResponse that = (BlogMemberResponse) o;
        return Objects.equals(blogId, that.blogId) &&
               Objects.equals(blogName, that.blogName) &&
               Objects.equals(mbNo, that.mbNo) &&
               Objects.equals(mbName, that.mbName);
    }

    @Override
    public int hashCode() {
        return Objects.hash(blogId, blogName, mbNo, mbName);
    }

    @Override
    public String toString() {
        return "BlogMemberResponse{" +
                "blogId=" + blogId +
                ", blogName='" + blogName + '\'' +
                ", mbNo=" + mbNo +
                ", mbName='" + mbName + '\'' +
                '}';
    }
}

```

ì´ê±°ë¥¼ ë ˆì½”ë“œë¥¼ ì“´ë‹¤ë©´?

```java

package com.nhnacademy.blog.mapping;

/**
 * TODO#3 - ë¸”ë¡œê·¸ ë§´ë²„ë¥¼ ì¡°íšŒí•  ë•Œ ì‘ë‹µ ê°ì²´ë¡œ ì‚¬ìš©í•˜ê¸°ìœ„í•´ì„œ BlogMemberResponse classë¥¼ êµ¬í˜„ í•©ë‹ˆë‹¤.
 *  - recordë¥¼ ì‚¬ìš©í•´ë„ ì¢‹ìŠµë‹ˆë‹¤.
 *  - getter methodë¥¼ êµ¬í˜„ í•©ë‹ˆë‹¤.
 *  - toString() methodë¥¼ êµ¬í˜„ í•©ë‹ˆë‹¤.
 *  - setter methodëŠ” êµ¬í˜„í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
 */

public record BlogMemberResponse(Long blogId, String blogName, Long mbNo, String mbName) {

}
```

JAVA 14ë¶€í„° ê¸°ë³¸ ì œê³µí•´ì£¼ëŠ” ê¸°ëŠ¥

<aside>
ğŸ’¡

# entityManager.contains()

- 1ì°¨ ìºì‹œì— ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
</aside>
