## Spring MVC

![image.png](attachment:d38a4bf1-42f3-4df5-8fbe-d3f776bb2068:image.png)

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2025-02-28 á„‹á…©á„Œá…¥á†« 9.51.28.png](attachment:9b2bce69-61ef-4613-ac29-844d4befade1:á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º_2025-02-28_á„‹á…©á„Œá…¥á†«_9.51.28.png)

- templates ì‹¤ì œë¡œ ìš°ë¦¬ê°€ ë§Œë“¤ htmlì´ ë“¤ì–´ê°ˆ ê²½ë¡œ
- [application.properties](http://application.properties) : DB, í†°ìº£ ë“±ë“± ê¸°íƒ€ ì„œë²„ ì„¤ì •
    - ìŠ¤í”„ë§ì€ pom.xmlì— dbê´€ë ¨ ì˜ì¡´ì„± ì¶”ê°€ì‹œ ì•Œì•„ì„œ Datasource ë§Œë“¤ì–´ì¤Œ
    - 

FrameWorkServletì„ ìƒì†ë°›ì€ **DispatcherServlet**

- ì´ì „ì— í–ˆë˜ FrontServletê³¼ ê°™ì€ ì—­í• 

**pom.xml**

```java
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>3.4.3</version>
        <relativePath/> <!-- lookup parent from repository -->
    </parent>
    <groupId>com.nhnacademy</groupId>
    <artifactId>mvc</artifactId>
    <version>0.0.1-SNAPSHOT</version>
    <name>mvc</name>
    <description>mvc</description>
    <url/>
    <licenses>
        <license/>
    </licenses>
    <developers>
        <developer/>
    </developers>
    <scm>
        <connection/>
        <developerConnection/>
        <tag/>
        <url/>
    </scm>
    <properties>
        <java.version>21</java.version>
    </properties>
    <dependencies>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-data-jpa</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-thymeleaf</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>

        <dependency>
            <groupId>com.h2database</groupId>
            <artifactId>h2</artifactId>
            <scope>runtime</scope>
        </dependency>
        <dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
            <optional>true</optional>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-test</artifactId>
            <scope>test</scope>
        </dependency>
    </dependencies>

    <build>
        <plugins>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-compiler-plugin</artifactId>
                <configuration>
                    <annotationProcessorPaths>
                        <path>
                            <groupId>org.projectlombok</groupId>
                            <artifactId>lombok</artifactId>
                        </path>
                    </annotationProcessorPaths>
                </configuration>
            </plugin>
            <plugin>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-maven-plugin</artifactId>
                <configuration>
<!--                    <excludes>-->
<!--                        <exclude>-->
<!--                            <groupId>org.projectlombok</groupId>-->
<!--                            <artifactId>lombok</artifactId>-->
<!--                        </exclude>-->
<!--                    </excludes>-->
                </configuration>
            </plugin>
        </plugins>
    </build>

</project>

```

---

## H2 ì„¤ì • í›„ ì½˜ì†”ë¡œ ì ‘ê·¼í•˜ê¸°

```java
spring.application.name=mvc
server.port=8080

server.tomcat.uri-encoding=UTF-8
server.tomcat.threads.max=200
server.tomcat.threads.max-queue-capacity=2147483647

spring.datasource.driver-class-name=org.h2.Driver
spring.datasource.username=sa
spring.datasource.password=
spring.datasource.url=jdbc:h2:mem:blog
spring.jpa.database-platform=org.hibernate.dialect.H2Dialect
spring.jpa.open-in-view=false
# http://localhost:8080/h2-console
spring.h2.console.enabled=true
```

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2025-02-28 á„‹á…©á„Œá…¥á†« 10.06.41.png](attachment:7bdb66de-ba27-4389-a117-692cc9d4b7d9:á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º_2025-02-28_á„‹á…©á„Œá…¥á†«_10.06.41.png)

<aside>
ğŸ’¡

## ì˜¤ëŠ˜ì˜ ëª©ì 

íšŒì›ê°€ì… êµ¬í˜„í•˜ê¸°

</aside>

1. ë©¤ë²„ ì—”í‹°í‹° êµ¬í˜„

```java
package com.nhnacademy.mvc.member.domain;

import jakarta.persistence.Entity;

import java.time.LocalDateTime;

@Entity
public class Member {
   
    private Long MbNo;
    private String mbEmail;
    private String mbPassword;
    private String mdMobile;
    private LocalDateTime createdAt;
    private LocalDateTime updatedAt;
    private LocalDateTime withdrawalAt;
    
}

```

ì—”í‹°í‹°ê°€ ë˜ê¸° ìœ„í•œ 3ê°€ì§€ ì¡°ê±´

1. pk    

2. ê¸°ë³¸ìƒì„±ì  

3. @Entity

```java
package com.nhnacademy.mvc.member.domain;

import jakarta.persistence.*;
import lombok.Getter;
import lombok.NoArgsConstructor;
import org.hibernate.annotations.CreationTimestamp;
import org.hibernate.annotations.UpdateTimestamp;

import java.time.LocalDateTime;

@Entity
@NoArgsConstructor
@Table(name = "members")
@Getter
public class Member {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "mb_no")
    private Long MbNo;

    @Column(nullable = false, length = 100)
    private String mbName;
    @Column(unique = true, nullable = false, length = 200)
    private String mbEmail;

    @Column(nullable = false, length = 100)
    private String mbPassword;

    @Column(unique = true,nullable = true, length = 50)
    private String mbMobile;

    @Column(nullable = false)
    private LocalDateTime createdAt;

    private LocalDateTime updatedAt;
    private LocalDateTime withdrawalAt;

    public Member(String mbEmail, String mbName, String mbPassword, String mbMobile){
        this.mbEmail = mbEmail;
        this.mbName = mbName;
        this.mbPassword = mbPassword;
        this.mbMobile = mbMobile;
    }

    public void updateMember(String mbName,String mbPassword, String mbMobile){
        this.mbName = mbName;
        this.mbPassword = mbPassword;
        this.mbMobile = mbMobile;
    }

    @PrePersist
    protected void onCreate(){
        this.createdAt = LocalDateTime.now();
    }

    @PreUpdate
    protected void onUpdate(){
        this.updatedAt = LocalDateTime.now();
    }

}

```

- ê¸°ë³¸ì ìœ¼ë¡œ @AllArgs.. í¸í•˜ê¸´ í•˜ì§€ë§Œ ì‚¬ìš©ì„ ê¶Œì¥í•˜ì§„ ì•ŠìŒ

ì´ê±¸ ì»´íŒŒì¼ ì‹œí‚¨ í›„ íƒ€ê²Ÿ í´ë”ì—ì„œ ìƒì„±ëœ ê²°ê³¼ë¥¼ ë³´ë©´

```java
//
// Source code recreated from a .class file by IntelliJ IDEA
// (powered by FernFlower decompiler)
//

package com.nhnacademy.mvc.member.domain;

import jakarta.persistence.Column;
import jakarta.persistence.Entity;
import jakarta.persistence.GeneratedValue;
import jakarta.persistence.GenerationType;
import jakarta.persistence.Id;
import jakarta.persistence.PrePersist;
import jakarta.persistence.PreUpdate;
import jakarta.persistence.Table;
import java.time.LocalDateTime;

@Entity
@Table(
    name = "members"
)
public class Member {
    @Id
    @GeneratedValue(
        strategy = GenerationType.IDENTITY
    )
    @Column(
        name = "mb_no"
    )
    private Long MbNo;
    @Column(
        nullable = false,
        length = 100
    )
    private String mbName;
    @Column(
        unique = true,
        nullable = false,
        length = 200
    )
    private String mbEmail;
    @Column(
        nullable = false,
        length = 100
    )
    private String mbPassword;
    @Column(
        unique = true,
        nullable = true,
        length = 50
    )
    private String mbMobile;
    @Column(
        nullable = false
    )
    private LocalDateTime createdAt;
    private LocalDateTime updatedAt;
    private LocalDateTime withdrawalAt;

    public Member(String mbEmail, String mbName, String mbPassword, String mbMobile) {
        this.mbEmail = mbEmail;
        this.mbName = mbName;
        this.mbPassword = mbPassword;
        this.mbMobile = mbMobile;
    }

    public void updateMember(String mbName, String mbPassword, String mbMobile) {
        this.mbName = mbName;
        this.mbPassword = mbPassword;
        this.mbMobile = mbMobile;
    }

    @PrePersist
    protected void onCreate() {
        this.createdAt = LocalDateTime.now();
    }

    @PreUpdate
    protected void onUpdate() {
        this.updatedAt = LocalDateTime.now();
    }
}

```

<aside>
ğŸ’¡

@ExtendWith(SpringExtension.class) ê°™ì€ ê²½ìš°ì—ëŠ” ëª¨ë“  ë¹ˆë“¤ì„ ë‹¤ í•œë²ˆì— ì˜¬ë ¤ì„œ ì“°ëŠ” ë¬´ê±°ìš´ ì–´ë…¸í…Œì´ì…˜
ì¦‰ í†µí•©í…ŒìŠ¤íŠ¸ ë‹¨ìœ„ì—ì„œë§Œ ì“°ì´ê³  ì—”í‹°í‹° í…ŒìŠ¤íŠ¸ ê°™ì´ ê°€ë³ê³  ë°ì´í„° íŠ¹í™”ëœ í…ŒìŠ¤íŠ¸ëŠ” @DataJpaTest ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë°”ëŒì§í•˜ë‹¤ 

ì„œë¹„ìŠ¤ í…ŒìŠ¤íŠ¸ëŠ” Mociktoë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒë„ ë§ˆì°¬ê°€ì§€

ì„œë¹„ìŠ¤, ì»¨íŠ¸ë¡¤ëŸ¬, ë°ì´í„°, ë ˆí¬ì§€í† ë¦¬ ë“± ê³„ì¸µë³„ë¡œ ìŠ¤í”„ë§ì—ì„œ ì œê³µí•´ì£¼ê³  ìˆìŒ

ì´ë¥¼ **ìŠ¬ë¼ì´ìŠ¤ í…ŒìŠ¤íŠ¸**ë¼ê³  í•¨

</aside>

```java
@Autowired
    TestEntityManager entityManager;
```

- í…ŒìŠ¤íŠ¸ìš© ì—”í‹°í‹° ë§¤ë‹ˆì €

```java

    @Test
    void registerMember(){
        Member member = new Member(
                "inho@nhnacademy.com",
                "inho",
                "1234",
                "01012123434"
        );
        entityManager.persist(member);

    }

```

- ì²˜ìŒ persistì‹œ
- Map<key, entity>ê°€ ë‚´ë¶€ì ìœ¼ë¡œ ì¡´ì¬í•˜ëŠ”ë° ì‹¤ì œ ë°ì´í„°ë¥¼ ë„£ì–´ë´ì•¼ í‚¤ê°€ ë‚˜ì˜¤ëŠ”ë° ì˜ì†í™” ì»¨í…ìŠ¤íŠ¸ ë“±ë¡ì‹œ insert !
- ì¦‰ í™•ì¸ìš© + ì €ì¥ ë˜ëŠ”ê±°ë‹¤
- 

---

## ë©¤ë²„ ë ˆí¬ì§€í† ë¦¬ ë§Œë“¤ê¸°

ìŠ¤í”„ë§ë¶€íŠ¸ì—ì„œëŠ” @EnableJpaRepository ê°™ì€ ê¸°ëŠ¥ë“¤ì„ ìë™ìœ¼ë¡œ ë§Œë“¤ì–´ì£¼ëŠ”ë° 

```java
package com.nhnacademy.mvc.member.repository;

import com.nhnacademy.mvc.member.domain.Member;
import org.springframework.data.jpa.repository.JpaRepository;

public interface MemberRepository extends JpaRepository<Member, Long> {
}

```

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2025-02-28 á„‹á…©á„Œá…¥á†« 11.39.26.png](attachment:ca08b240-e800-4daf-835f-3f7f62a85b66:á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º_2025-02-28_á„‹á…©á„Œá…¥á†«_11.39.26.png)

ë©¤ë²„ë ˆí¬ì§€í† ë¦¬ì™€ ê°™ì€ ì¸í„°í˜ì´ìŠ¤ë¥¼ ë“±ë¡í•´ë‘ë©´ êµ¬í˜„ì²´ë“¤ì´ ë¹ˆì— ë“±ë¡ë˜ëŠ” ê³¼ì • 

---

## Member Service & Dto(Data transfer Object)

```java
package com.nhnacademy.mvc.member.dto;

import lombok.Value;

import java.time.LocalDateTime;

@Value
public class MemberResponse {
    Long mbNo;
    String mbName;
    String mbPassword;
    String mbMobile;
    LocalDateTime createdAt;
    LocalDateTime updatedAt;
    LocalDateTime withdrawalAt;
}

```

**ì´ë ‡ê²Œ ë§Œë“  í›„ mvn clean compile â†’ íƒ€ê²Ÿ í´ë”ë¥¼ ê°€ë³´ë©´** 

```java
//
// Source code recreated from a .class file by IntelliJ IDEA
// (powered by FernFlower decompiler)
//

package com.nhnacademy.mvc.member.dto;

import java.time.LocalDateTime;
import lombok.Generated;

public final class MemberResponse {
    private final Long mbNo;
    private final String mbName;
    private final String mbPassword;
    private final String mbMobile;
    private final LocalDateTime createdAt;
    private final LocalDateTime updatedAt;
    private final LocalDateTime withdrawalAt;

    @Generated
    public MemberResponse(final Long mbNo, final String mbName, final String mbPassword, final String mbMobile, final LocalDateTime createdAt, final LocalDateTime updatedAt, final LocalDateTime withdrawalAt) {
        this.mbNo = mbNo;
        this.mbName = mbName;
        this.mbPassword = mbPassword;
        this.mbMobile = mbMobile;
        this.createdAt = createdAt;
        this.updatedAt = updatedAt;
        this.withdrawalAt = withdrawalAt;
    }

    @Generated
    public Long getMbNo() {
        return this.mbNo;
    }

    @Generated
    public String getMbName() {
        return this.mbName;
    }

    @Generated
    public String getMbPassword() {
        return this.mbPassword;
    }

    @Generated
    public String getMbMobile() {
        return this.mbMobile;
    }

    @Generated
    public LocalDateTime getCreatedAt() {
        return this.createdAt;
    }

    @Generated
    public LocalDateTime getUpdatedAt() {
        return this.updatedAt;
    }

    @Generated
    public LocalDateTime getWithdrawalAt() {
        return this.withdrawalAt;
    }

    @Generated
    public boolean equals(final Object o) {
        if (o == this) {
            return true;
        } else if (!(o instanceof MemberResponse)) {
            return false;
        } else {
            MemberResponse other = (MemberResponse)o;
            Object this$mbNo = this.getMbNo();
            Object other$mbNo = other.getMbNo();
            if (this$mbNo == null) {
                if (other$mbNo != null) {
                    return false;
                }
            } else if (!this$mbNo.equals(other$mbNo)) {
                return false;
            }

            Object this$mbName = this.getMbName();
            Object other$mbName = other.getMbName();
            if (this$mbName == null) {
                if (other$mbName != null) {
                    return false;
                }
            } else if (!this$mbName.equals(other$mbName)) {
                return false;
            }

            Object this$mbPassword = this.getMbPassword();
            Object other$mbPassword = other.getMbPassword();
            if (this$mbPassword == null) {
                if (other$mbPassword != null) {
                    return false;
                }
            } else if (!this$mbPassword.equals(other$mbPassword)) {
                return false;
            }

            Object this$mbMobile = this.getMbMobile();
            Object other$mbMobile = other.getMbMobile();
            if (this$mbMobile == null) {
                if (other$mbMobile != null) {
                    return false;
                }
            } else if (!this$mbMobile.equals(other$mbMobile)) {
                return false;
            }

            Object this$createdAt = this.getCreatedAt();
            Object other$createdAt = other.getCreatedAt();
            if (this$createdAt == null) {
                if (other$createdAt != null) {
                    return false;
                }
            } else if (!this$createdAt.equals(other$createdAt)) {
                return false;
            }

            Object this$updatedAt = this.getUpdatedAt();
            Object other$updatedAt = other.getUpdatedAt();
            if (this$updatedAt == null) {
                if (other$updatedAt != null) {
                    return false;
                }
            } else if (!this$updatedAt.equals(other$updatedAt)) {
                return false;
            }

            Object this$withdrawalAt = this.getWithdrawalAt();
            Object other$withdrawalAt = other.getWithdrawalAt();
            if (this$withdrawalAt == null) {
                if (other$withdrawalAt != null) {
                    return false;
                }
            } else if (!this$withdrawalAt.equals(other$withdrawalAt)) {
                return false;
            }

            return true;
        }
    }

    @Generated
    public int hashCode() {
        int PRIME = 59;
        int result = 1;
        Object $mbNo = this.getMbNo();
        result = result * 59 + ($mbNo == null ? 43 : $mbNo.hashCode());
        Object $mbName = this.getMbName();
        result = result * 59 + ($mbName == null ? 43 : $mbName.hashCode());
        Object $mbPassword = this.getMbPassword();
        result = result * 59 + ($mbPassword == null ? 43 : $mbPassword.hashCode());
        Object $mbMobile = this.getMbMobile();
        result = result * 59 + ($mbMobile == null ? 43 : $mbMobile.hashCode());
        Object $createdAt = this.getCreatedAt();
        result = result * 59 + ($createdAt == null ? 43 : $createdAt.hashCode());
        Object $updatedAt = this.getUpdatedAt();
        result = result * 59 + ($updatedAt == null ? 43 : $updatedAt.hashCode());
        Object $withdrawalAt = this.getWithdrawalAt();
        result = result * 59 + ($withdrawalAt == null ? 43 : $withdrawalAt.hashCode());
        return result;
    }

    @Generated
    public String toString() {
        Long var10000 = this.getMbNo();
        return "MemberResponse(mbNo=" + var10000 + ", mbName=" + this.getMbName() + ", mbPassword=" + this.getMbPassword() + ", mbMobile=" + this.getMbMobile() + ", createdAt=" + String.valueOf(this.getCreatedAt()) + ", updatedAt=" + String.valueOf(this.getUpdatedAt()) + ", withdrawalAt=" + String.valueOf(this.getWithdrawalAt()) + ")";
    }
}

```

Getter, ë¶ˆë³€ê°ì²´, toString, hashCode,  toString.. ì¦‰ Setter ì œì™¸í•˜ê³  ëª¨ë‘ ë§Œë“¤ì–´ì¤Œ

```java
package com.nhnacademy.mvc.member.service.impl;

import com.nhnacademy.mvc.member.dto.MemberRegisterRequest;
import com.nhnacademy.mvc.member.dto.MemberResponse;
import com.nhnacademy.mvc.member.dto.MemberUpdateRequest;
import com.nhnacademy.mvc.member.service.MemberService;
import jakarta.transaction.Transactional;
import org.springframework.stereotype.Service;

@Service
@Transactional
public class MemberServiceImpl implements MemberService {
    @Override
    public MemberResponse registerMember(MemberRegisterRequest memberRegisterRequest) {
        return null;
    }

    @Override
    public MemberResponse getMemberByNo(Long mbNo) {
        return null;
    }

    @Override
    public MemberResponse getMemberByEmail(String email) {
        return null;
    }

    @Override
    public void withdrawalMember(Long mbNo) {

    }

    @Override
    public MemberResponse updateMember(Long mbNo, MemberUpdateRequest updateRequest) {
        return null;
    }
}

```

- ì„œë¹„ìŠ¤ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ë¬¸ì œë°œìƒì‹œ ë¡¤ë°±í•´ì¤˜ì•¼í•´ì„œ @Transactional
    - ëª¨ë“  í•˜ìœ„ ë©”ì†Œë“œë“¤ì— ì ìš©ì„ í•˜ê² ë‹¤
- ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº”ì„ ìœ„í•´ @Service

```java
    @Override
    @Transactional(readOnly = true)
    public MemberResponse getMemberByNo(Long mbNo) {
        return null;
    }

```

- ì´ë ‡ê²Œí•˜ë©´ ìŠ¤ëƒ…ìƒ·ë“¤ì„ ì•ˆë§Œë“¤ê³  ë”í‹°ì²´í‚¹ì„ ì•ˆí•˜ê¸° ë•Œë¬¸ì— ì¢€ ë” ë¹ ë¥´ë‹¤
- íŠ¸ëœì­ì…˜ ì²˜ë¦¬ã„´ã„´ ì˜ì†ì„± ë§¤ë‹ˆì €ì•ˆì—ì„œì˜ ì²˜ë¦¬ê°€ ì¢€ ë‹¬ë¼ì§
    
    

---

### ì˜ˆì™¸ ë§Œë“¤ê¸°

```java
package com.nhnacademy.mvc.common;

import lombok.Getter;

public class HttpException extends RuntimeException {
    @Getter
    private final int statusCode;
    
    public HttpException(int statusCode, String message) {
        super(message);
        this.statusCode = statusCode;
    }
}

```

```java
package com.nhnacademy.mvc.common;

public class ConflictException extends HttpException {
    private static final int STATUS_CODE= 409;

    public ConflictException(){
        super(STATUS_CODE, "Conflict Exception");
    }
    public ConflictException(String message) {

        super(STATUS_CODE, message);
    }
}

```

```java
package com.nhnacademy.mvc.common;

public class NotFoundException extends HttpException {
    private static final int STATUS_CODE = 404; 
    
    public NotFoundException(){
        super(STATUS_CODE, "Not found resources");
    }
            
    public NotFoundException(String message) {
        super(STATUS_CODE, message);
    }
}

```

```java
package com.nhnacademy.mvc.common;

public class MemberNotFoundException extends NotFoundException {
    
    
    public MemberNotFoundException(String identity) {
        super("Member not found : %s ".formatted(identity));
        
    }
}

```

ì´ëŸ°ì‹ìœ¼ë¡œ í™•ì¥í•´ê°€ë©´ì„œ ë§Œë“¤ê¸°

```java

public class MemberServiceImpl implements MemberService {

    MemberRepository memberRepository;

    @Override
    public MemberResponse registerMember(MemberRegisterRequest memberRegisterRequest) {
        //ë“±ë¡ëœ íšŒì› - ì´ë©”ì¼ ì²´í¬
        String email = memberRegisterRequest.getMbEmail();
        if(memberRepository.existsMemberByMbEmail(email)){
            throw new ConflictException("Member email : already exists".formatted(email));
        }
        //ì „í™” ë²ˆí˜¸ ì²´í¬

        //

        return null;
    }
```

---

## Service Impl

```java

    @Override
    public MemberResponse updateMember(Long mbNo, MemberUpdateRequest updateRequest) {
        Member member = memberRepository.findById(mbNo).orElseThrow(
                ()->new MemberNotFoundException(String.valueOf(mbNo))
        );
        
        // ë°”ê¾¸ë ¤ëŠ” ë²ˆí˜¸ê°€ DBì— ì¡´ì¬í•˜ëŠ”ì§€ ì²´í¬í•˜ê¸° 
        if(Objects.nonNull(updateRequest.getMbMobile()) &&!member.getMbMobile().equals(updateRequest.getMbMobile())){
            if(memberRepository.findMemberByMbMobile((updateRequest.getMbMobile()))){
                throw new ConflictException("Member Mobile :%s already exists");
            }
        }
        
        member.updateMember(
                updateRequest.getMbName(),
                updateRequest.getMbPassword(),
                updateRequest.getMbMobile()
        );
        
        return toMemberResponse(member);
    }

```

```java
package com.nhnacademy.mvc.member.service.impl;

import com.nhnacademy.mvc.common.ConflictException;
import com.nhnacademy.mvc.common.MemberNotFoundException;
import com.nhnacademy.mvc.member.domain.Member;
import com.nhnacademy.mvc.member.dto.MemberRegisterRequest;
import com.nhnacademy.mvc.member.dto.MemberResponse;
import com.nhnacademy.mvc.member.dto.MemberUpdateRequest;
import com.nhnacademy.mvc.member.repository.MemberRepository;
import com.nhnacademy.mvc.member.service.MemberService;

import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.util.Objects;

@Service
@RequiredArgsConstructor
@Transactional
public class MemberServiceImpl implements MemberService {

    MemberRepository memberRepository;

    @Override
    public MemberResponse registerMember(MemberRegisterRequest memberRegisterRequest) {
        //ë“±ë¡ëœ íšŒì› - ì´ë©”ì¼ ì²´í¬
        String email = memberRegisterRequest.getMbEmail();
        if(memberRepository.existsMemberByMbEmail(email)){
            throw new ConflictException("Member email : already exists".formatted(email));
        }
        //ì „í™” ë²ˆí˜¸ ì²´í¬
        String mobile = memberRegisterRequest.getMbMobile();
        if(memberRepository.existsMemberByMbMobile(mobile)){
            throw new ConflictException("Member mobile : already exists".formatted(mobile));
        }
        //

        Member member = new Member(
                memberRegisterRequest.getMbEmail(),
                memberRegisterRequest.getMbName(),
                memberRegisterRequest.getMbPassword(),
                memberRegisterRequest.getMbMobile()
        );

        memberRepository.save(member);

        return toMemberResponse(member);
    }

    @Override
    @Transactional(readOnly = true)
    public MemberResponse getMemberByNo(Long mbNo) {
        Member member = memberRepository.findById(mbNo).orElseThrow(
                ()-> new MemberNotFoundException(String.valueOf(mbNo))
        );
        return toMemberResponse(member);
    }

    @Override
    @Transactional(readOnly = true)
    public MemberResponse getMemberByEmail(String email) {
        Member member = memberRepository.findMemberByMbEmail(email).orElseThrow(
                ()->new MemberNotFoundException(email)
        );

        return toMemberResponse(member);
    }

    @Override
    public void withdrawalMember(Long mbNo) {
        Member member = memberRepository.findById(mbNo).orElseThrow(
                ()->new MemberNotFoundException(String.valueOf(mbNo))
        );

        member.withdrawAccount();
    }

    @Override
    public MemberResponse updateMember(Long mbNo, MemberUpdateRequest updateRequest) {
        Member member = memberRepository.findById(mbNo).orElseThrow(
                ()->new MemberNotFoundException(String.valueOf(mbNo))
        );

        // ë°”ê¾¸ë ¤ëŠ” ë²ˆí˜¸ê°€ DBì— ì¡´ì¬í•˜ëŠ”ì§€ ì²´í¬í•˜ê¸°
        if(Objects.nonNull(updateRequest.getMbMobile()) && !member.getMbMobile().equals(updateRequest.getMbMobile())){
            if(memberRepository.findMemberByMbMobile((updateRequest.getMbMobile()))){
                throw new ConflictException("Member Mobile :%s already exists");
            }
        }

        member.updateMember(
                updateRequest.getMbName(),
                updateRequest.getMbPassword(),
                updateRequest.getMbMobile()
        );

        return toMemberResponse(member);
    }

    private MemberResponse toMemberResponse(Member member){
        return new MemberResponse(
                member.getMbNo(),
                member.getMbName(),
                member.getMbEmail(),
                member.getMbPassword(),
                member.getMbMobile(),
                member.getCreatedAt(),
                member.getUpdatedAt(),
                member.getWithdrawalAt()
        );

    }
}

```

- ì„œë¹„ìŠ¤ í´ë˜ìŠ¤ í…ŒìŠ¤íŠ¸ì½”ë“œ í•  ë•ŒëŠ” **Mocikto**

```java
    @Test
    @DisplayName("member-ë“±ë¡")
    void registerMember() {
        //given

        //when
        
        //then
        
    }

```

ìŠ¤í”„ë§ì—ì„œ ê¶Œì¥í•˜ëŠ”  í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„± ë°©ë²•

- given : ë°ì´í„° ì¤€ë¹„í•˜ê¸°
- when : ë°ì´í„° ì£¼ì… ??
- then : Assertions

```java

    @Override
    public MemberResponse registerMember(MemberRegisterRequest memberRegisterRequest) {
        //ë“±ë¡ëœ íšŒì› - ì´ë©”ì¼ ì²´í¬
        String email = memberRegisterRequest.getMbEmail();
        if(memberRepository.existsMemberByMbEmail(email)){
            throw new ConflictException("Member email : already exists".formatted(email));
        }
        //ì „í™” ë²ˆí˜¸ ì²´í¬
        String mobile = memberRegisterRequest.getMbMobile();
        if(memberRepository.existsMemberByMbMobile(mobile)){
            throw new ConflictException("Member mobile : already exists".formatted(mobile));
        }
        //

        Member member = new Member(
                memberRegisterRequest.getMbEmail(),
                memberRegisterRequest.getMbName(),
                memberRegisterRequest.getMbPassword(),
                memberRegisterRequest.getMbMobile()
        );

        memberRepository.save(member);
                return toMemberResponse(member);
}
```

ì´ë ‡ê²Œí•˜ë©´ ë¦¬í„´ê°’ì´ ì•„ë‹Œ saveëœ ê°’ì„ ì“°ê²Œ ë˜ëŠ”ë°

saveí•˜ëŠ” ìˆœê°„ ë©¤ë²„ ë²ˆí˜¸, ìƒì„± ì¼ì ë“±ì´ ìƒì„±ë˜ê²Œ ë˜ëŠ”ë° 

```java
 
    @Test
    @DisplayName("member-ë“±ë¡")
    void registerMember() {

        //given
        MemberRegisterRequest registerRequest = new MemberRegisterRequest(
                "inho",
                "inho@nhn.com",
                "1234",
                "01023231212"
        );

        MemberResponse memberResponse = new MemberResponse(
                1L,
                "inho",
                "inho@nhn.com",
                "1234",
                "01023231212",
                LocalDateTime.now(),
                null,
                null
        );

        //when
        Mockito.when(memberRepository.existsMemberByMbEmail(anyString())).thenReturn(false);
        Mockito.when(memberRepository.existsMemberByMbMobile(anyString())).thenReturn(false);
        Mockito.when(memberRepository.save(Mockito.any())).thenReturn(memberResponse);
        Mockito.doAnswer(invocationOnMock -> {
                Member member = invocationOnMock.getArgument(0);
            ReflectionTestUtils.setField(member, "mbNo", 1L);
            ReflectionTestUtils.setField(member, "createdAt", LocalDateTime.now());
            return member;
        }).when(memberRepository.save(Mockito.any()));

    }
```

í•˜ì§€ë§Œ í…ŒìŠ¤íŠ¸ì½”ë“œì— ì´ë ‡ê²Œ ì“°ë©´ 

save í•˜ëŠ” ìˆœê°„ ì•ˆì— ë©¤ë²„ ê°ì²´ì— ê·¸ë ‡ê²Œ ì„¤ì •í•´ì¤˜ë¼ëŠ” ê²ƒì´ doAnswer

```java
 package com.nhnacademy.mvc.member.service.impl;

import ch.qos.logback.core.testUtil.MockInitialContext;
import com.nhnacademy.mvc.common.ConflictException;
import com.nhnacademy.mvc.member.domain.Member;
import com.nhnacademy.mvc.member.dto.MemberRegisterRequest;
import com.nhnacademy.mvc.member.dto.MemberResponse;
import com.nhnacademy.mvc.member.repository.MemberRepository;
import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.ExtendWith;
import org.mockito.InjectMocks;
import org.mockito.Mock;
import org.mockito.Mockito;
import org.mockito.junit.jupiter.MockitoExtension;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.test.context.bean.override.mockito.MockitoBean;
import org.springframework.test.util.ReflectionTestUtils;
import org.springframework.ui.Model;

import java.time.LocalDateTime;

import static org.junit.jupiter.api.Assertions.*;
import static org.mockito.ArgumentMatchers.any;
import static org.mockito.ArgumentMatchers.anyString;

@ExtendWith(MockitoExtension.class)

class MemberServiceImplTest {

    @Mock
    MemberRepository memberRepository;

    @InjectMocks
    MemberServiceImpl memberService;

    @BeforeEach
    void setUp() {
    }

    @Test
    @DisplayName("member-ë“±ë¡")
    void registerMember() {

        //given
        MemberRegisterRequest registerRequest = new MemberRegisterRequest(
                "inho",
                "inho@nhn.com",
                "1234",
                "01023231212"
        );

        MemberResponse memberResponse = new MemberResponse(
                1L,
                "inho",
                "inho@nhn.com",
                "1234",
                "01023231212",
                LocalDateTime.now(),
                null,
                null
        );

        //when
        Mockito.when(memberRepository.existsMemberByMbEmail(anyString())).thenReturn(false);
        Mockito.when(memberRepository.existsMemberByMbEmail("inho@nhn.com")).thenReturn(false);
        Mockito.when(memberRepository.existsMemberByMbMobile("01023231212")).thenReturn(false);
        Mockito.doAnswer(invocation -> {
            Member member = invocation.getArgument(0);
            ReflectionTestUtils.setField(member, "mbNo", 1L);
            ReflectionTestUtils.setField(member, "createdAt", LocalDateTime.now());
            return member;
        }).when(memberRepository).save(any(Member.class));
        MemberResponse actual = memberService.registerMember(registerRequest);

        Assertions.assertNotNull(actual);

        Assertions.assertAll(
                ()->Assertions.assertEquals(1L, actual.getMbNo()),
                ()->Assertions.assertEquals("inho", actual.getMbName()),
                ()->Assertions.assertEquals("inho@nhn.com", actual.getMbEmail()),
                ()->Assertions.assertEquals("1234", actual.getMbPassword()),
                ()->Assertions.assertEquals("01023231212", actual.getMbMobile()),
                ()->Assertions.assertNotNull(actual.getCreatedAt()),
                ()->Assertions.assertNull(actual.getUpdatedAt()),
                ()->Assertions.assertNull(actual.getWithdrawalAt()),
                () -> Assertions.assertEquals("ì´ìš©", actual.getStatus())
        );

        Mockito.verify(memberRepository, Mockito.times(1)).save(any(Member.class));

    }

    @Test
    void getMemberByNo() {
    }

    @Test
    void getMemberByEmail() {
        //given
        MemberRegisterRequest registerRequest = new MemberRegisterRequest(
                "inho",
                "inho@nhn.com",
                "1234",
                "01023231212"
        );

        MemberResponse memberResponse = new MemberResponse(
                1L,
                "inho",
                "inho@nhn.com",
                "1234",
                "01023231212",
                LocalDateTime.now(),
                null,
                null
        );

      Mockito.when(memberRepository.existsMemberByMbEmail(anyString())).thenReturn(true);

      Assertions.assertThrows(ConflictException.class,()->{
          memberService.registerMember(registerRequest);
      });
    }

    @Test
    void withdrawalMember() {
    }

    @Test
    void updateMember() {
    }
}
```

- ìŠ¤í”„ë§ ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ë©”ì†Œë“œ ë‹¨ìœ„ë¡œ ë¦¬í€˜ìŠ¤íŠ¸ ë§¤í•‘ì´ ê°€ëŠ¥

```java
package com.nhnacademy.mvc.controller;

import org.springframework.http.HttpMethod;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;

@Controller
@RequestMapping("/member")
public class MemberController {

    @GetMapping("/register") // -> /member/register
    public String register(){

        return "member/register";
    }
}

```

```java
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Memberë“±ë¡</title>
</head>
<body>
    <form method="post" action="member/register">
      <table border="1">
          <tbody>
            <tr >
              <th>ì´ë¦„</th>
                <td><input type="text" name="mbName"></td>
            </tr>
            <tr >
              <th>ì´ë©”ì¼</th>
              <td><input type="text" name="mbEmail"></td>
            </tr>
            <tr >
              <th>ë¹„ë°€ë²ˆí˜¸</th>
              <td><input type="password" name="mbPassword"></td>
            </tr>
            <tr >
              <th>ì—°ë½ì²˜</th>
              <td><input type="text" name="mbMobile"></td>
            </tr>
          </tbody>
          <tfoot>
            <tr>
              <td colspan="2">
                <button type="submit">íšŒì›ê°€ì…</button>
              </td>
            </tr>
          </tfoot>

      </table>
    </form>
</body>
</html>
```

MemberDTOì˜ í•„ë“œì™€ ë§ì¶°ì¤Œ ì¼ë¶€ëŸ¬ 

---

```java
package com.nhnacademy.mvc.member.dto;

import jakarta.validation.constraints.Email;
import jakarta.validation.constraints.NotBlank;
import jakarta.validation.constraints.NotEmpty;
import lombok.Value;
import org.hibernate.validator.constraints.Length;

public class MemberRegisterRequest {
    public String getMbName() {
        return mbName;
    }

    public String getMbEmail() {
        return mbEmail;
    }

    public String getMbPassword() {
        return mbPassword;
    }

    public String getMbMobile() {
        return mbMobile;
    }

    public MemberRegisterRequest(String mbName, String mbEmail, String mbPassword, String mbMobile) {
        this.mbName = mbName;
        this.mbEmail = mbEmail;
        this.mbPassword = mbPassword;
        this.mbMobile = mbMobile;
    }

    @NotEmpty
    String mbName;

    @Email
    String mbEmail;

    @NotEmpty
    @Length(min = 8, max = 16)
    String mbPassword;

    String mbMobile;

}

```

ì´ë ‡ê²Œ Validation ì˜ì¡´ì„± ì¶”ê°€í•˜ë©´ ì•Œì•„ì„œ ì´ë ‡ê²Œ í•´ì£¼ëŠ”ë° ê²€ì‚¬í•  ë•Œ 

ì´ ì–´ë…¸í…Œì´ì…˜ì— ë§ê²Œ ì ìš©í•´ë‹¬ë¼ê³  í•˜ëŠ”ê²Œ 

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2025-02-28 á„‹á…©á„’á…® 4.08.19.png](attachment:9f18449f-9d4e-4cf9-adf7-bb9252b014d9:á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º_2025-02-28_á„‹á…©á„’á…®_4.08.19.png)

@Validì–´ë…¸í…Œì´ì…˜ 

ê³µí†µ ì—ëŸ¬ ì²˜ë¦¬ 

```java
package com.nhnacademy.mvc.common.advice;

import com.nhnacademy.mvc.common.exception.HttpException;
import org.springframework.http.HttpStatus;
import org.springframework.http.HttpStatusCode;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.validation.FieldError;
import org.springframework.web.bind.MethodArgumentNotValidException;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.ResponseStatus;
import org.springframework.web.servlet.ModelAndView;

import java.util.ArrayList;
import java.util.List;

@Controller
public class CommonAdvice {

    @ResponseStatus(code = HttpStatus.BAD_REQUEST)
    @ExceptionHandler(value = {MethodArgumentNotValidException.class})
    public String handleMethodArgumentNotValidException(MethodArgumentNotValidException e, Model model){
        // Modelì€ Springì˜ UI
        List<String> erros = new ArrayList<>();

        e.getBindingResult().getAllErrors().forEach((objectError -> {
            if(objectError instanceof FieldError fieldError){
                String filedName = fieldError.getField();
                String message = fieldError.getDefaultMessage();
                erros.add("%s : %s".formatted(filedName, message));

            }
        }));

        model.addAttribute("errorMessage", String.join(", ", erros));
        return "common/error";
    }

    @ExceptionHandler(value = {HttpException.class})
    public ModelAndView handleHttpException(HttpException e){
        String errorMessage = "httpStatus:%s, %s".formatted(e.getStatusCode(), e.getMessage());

        ModelAndView modelAndView = new ModelAndView("common/error");
        modelAndView.addObject("errorMessage", errorMessage);
        modelAndView.setStatus(HttpStatusCode.valueOf(e.getStatusCode()));

        return modelAndView;

    }

    @ResponseStatus(HttpStatus.INTERNAL_SERVER_ERROR)
    @ExceptionHandler(value = {Throwable.class})
    public String handleException(Throwable e, Model model){
        model.addAttribute("errorMessgae", e.getMessage());
        return "common/error";
    }

}

```

```java
````
    @ExceptionHandler(value = {HttpException.class})
    public ModelAndView handleHttpException(HttpException e){
        String errorMessage = "httpStatus:%s, %s".formatted(e.getStatusCode(), e.getMessage());

        ModelAndView modelAndView = new ModelAndView("common/error");
        modelAndView.addObject("errorMessage", errorMessage);
        modelAndView.setStatus(HttpStatusCode.valueOf(e.getStatusCode()));

        return modelAndView;

    }
```

ì´ ê²½ìš° ì›ë˜ëŒ€ë¡œ ì—ëŸ¬ ì²˜ë¦¬í•˜ë©´ ë·°ë„¤ì„ë§Œ ë¦¬í„´í•˜ë‹ˆê¹Œ í•­ìƒ 200OKì˜€ëŠ”ë°

ëª¨ë¸ì•¤ë·° ê°ì²´ë¥¼ ì´ìš©í•´ì„œ ì‘ë‹µì½”ë“œë¥¼ ë™ì ìœ¼ë¡œ ì„¤ì •í•  ìˆ˜ ìˆê²Œ í•˜ê¸° ìœ„í•´ì„œ ModelAndView ì‚¬ìš© 

```java
 
import java.util.ArrayList;
import java.util.List;

@ControllerAdvice(basePackageClasses = MemberController.class) // MemberController í´ë˜ìŠ¤ í•œì • ì²˜ë¦¬í•˜ê² ë”° ë¼ëŠ” ëœ» 
public class CommonAdvice {

```

ì•„ë¬´ê²ƒë„ ì•ˆë‹¬ë©´ ì „ì—­ìœ¼ë¡œ ì²˜ë¦¬í•œë‹¤ëŠ” ëœ» 

ì €ë ‡ê²Œ ë‹¬ì•„ì£¼ë©´ MemberController í´ë˜ìŠ¤ í•œì • ì²˜ë¦¬í•˜ê² ë‹¤ ë¼ëŠ” ëœ» 

- ì»¨íŠ¸ë¡¤ëŸ¬ì—ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì‘ì„± ã„´ã„´ã„´
- 

```java
package com.nhnacademy.mvc.common.event;

import org.springframework.boot.context.event.ApplicationReadyEvent;
import org.springframework.context.ApplicationListener;
import org.springframework.stereotype.Component;

@Component
public class ApplicationStartEvent implements ApplicationListener<ApplicationReadyEvent> {
    @Override
    public void onApplicationEvent(ApplicationReadyEvent event) {
        
        
    }
}

```

- ìŠ¤í”„ë§ì—ì„œ ì´ë²¤íŠ¸ íƒ€ì… ì¡ì„ ë•Œ
- ì˜ˆì‹œë¡œ ìŠ¤í”„ë§ ì‹œì‘í•  ë•Œ ì´ˆê¸°í™”ë¼ë˜ì§€
